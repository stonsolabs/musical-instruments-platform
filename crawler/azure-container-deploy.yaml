# Azure Container App deployment configuration
# This file can be used with Azure CLI to deploy the crawler

apiVersion: 2021-03-01
location: eastus
name: musical-instruments-crawler
properties:
  managedEnvironmentId: /subscriptions/{SUBSCRIPTION_ID}/resourceGroups/{RESOURCE_GROUP}/providers/Microsoft.App/managedEnvironments/{ENVIRONMENT_NAME}
  configuration:
    secrets:
      - name: database-url
        value: ""  # Set via Azure CLI or portal
      - name: iproyal-proxy-url  
        value: ""  # Set via Azure CLI or portal
    ingress:
      external: false
      targetPort: 8000
    registries: []
  template:
    containers:
      - image: {REGISTRY_URL}/musical-instruments-crawler:latest
        name: crawler
        env:
          - name: DATABASE_URL
            secretRef: database-url
          - name: IPROYAL_PROXY_URL
            secretRef: iproyal-proxy-url
          - name: TEST_MODE
            value: "false"
          - name: MAX_CONCURRENT_REQUESTS
            value: "3"
          - name: DELAY_MIN_SECONDS
            value: "2.0"
          - name: DELAY_MAX_SECONDS
            value: "4.0"
        resources:
          cpu: 1.0
          memory: 2Gi
    scale:
      minReplicas: 0
      maxReplicas: 1
tags: {}
type: Microsoft.App/containerApps