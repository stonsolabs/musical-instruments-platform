# Azure Container App deployment configuration for Thomann Image Downloader
# This file can be used with Azure CLI to deploy the image downloader

apiVersion: 2021-03-01
location: eastus
name: thomann-image-downloader
properties:
  managedEnvironmentId: /subscriptions/{SUBSCRIPTION_ID}/resourceGroups/{RESOURCE_GROUP}/providers/Microsoft.App/managedEnvironments/{ENVIRONMENT_NAME}
  configuration:
    secrets:
      - name: database-url
        value: ""  # Set via Azure CLI or portal
      - name: iproyal-proxy-url  
        value: ""  # Set via Azure CLI or portal
      - name: azure-storage-connection-string
        value: ""  # Set via Azure CLI or portal
    ingress:
      external: false
      targetPort: 8000
    registries: []
  template:
    containers:
      - image: {REGISTRY_URL}/thomann-image-downloader:latest
        name: image-downloader
        env:
          - name: DATABASE_URL
            secretRef: database-url
          - name: IPROYAL_PROXY_URL
            secretRef: iproyal-proxy-url
          - name: AZURE_STORAGE_CONNECTION_STRING
            secretRef: azure-storage-connection-string
          - name: AZURE_STORAGE_CONTAINER
            value: "product-images"
          - name: MAX_CONCURRENT_DOWNLOADS
            value: "20"
          - name: TEST_MODE
            value: "false"
        resources:
          cpu: 1.0
          memory: 2Gi
    scale:
      minReplicas: 0
      maxReplicas: 3
tags: {}
type: Microsoft.App/containerApps
